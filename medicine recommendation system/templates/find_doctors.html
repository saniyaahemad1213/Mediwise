
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <!--========== BOX ICONS ==========-->
        <link href='https://cdn.jsdelivr.net/npm/boxicons@2.0.5/css/boxicons.min.css' rel='stylesheet'>
        <title>Find Doctors | Mediwise</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link rel="stylesheet" href="../static/styles.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    #mapid {
      height: 500px;
      width: 100%;
      margin-top: 2rem;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      display: none;
    }
    #doctor-list ul {
      list-style: none;
      padding: 0;
      margin-top: 1rem;
    }
    #doctor-list li {
      background-color: #f9f9f9;
      border: 1px solid #ddd;
      padding: 10px;
      margin-bottom: 8px;
      border-radius: 5px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    .filter-bar {
      margin-top: 2rem;
      text-align: center;
    }
    .filter-bar select, .filter-bar button {
      padding: 0.5rem 1rem;
      margin-left: 0.5rem;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    /* Make sure header/nav stays above the map */
.l-header, header, nav {
  position: relative;
  z-index: 100;
}

/* Make sure the map stays below the navbar */
#mapid {
  z-index: 1;
}
  </style>
  <!-- Lottie Player -->
<script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>

        <link rel="stylesheet" href="../static/styles.css">

        <title>Mediwise - Your Health Partner</title>
   
    <body>
 
        <!--========== SCROLL TOP ==========-->
        <a href="#" class="scrolltop" id="scroll-top">
            <i class='bx bx-chevron-up scrolltop__icon'></i>
        </a>

        <!--========== HEADER ==========-->
          <header class="l-header" id="header" style="background: #f8fbfd;">
    <nav class="nav bd-container" style="background: #f8fbfd; display: flex; justify-content: space-between; align-items: center;">
      <a href="#" class="nav__logo" style="display: flex; align-items: center; font-size: 1.2rem; font-weight: 500;">
        <svg width="32" height="32" viewBox="0 0 32 32" fill="none" style="vertical-align: middle; margin-right:8px;">
          <circle cx="16" cy="16" r="16" fill="#4F8FF3" />
          <path d="M16 8v16M8 16h16" stroke="#fff" stroke-width="2" stroke-linecap="round" />
        </svg>
        Mediwise
      </a>
      <div class="nav__menu">
        <ul class="nav__list">
          <li class="nav__item"><a href="/#home" class="nav__link active-link">Home</a></li>
          <li class="nav__item"><a href="/#about" class="nav__link">About</a></li>
          <li class="nav__item"><a href="/symptom_checker" class="nav__link">Check Symptoms</a></li>
          <li class="nav__item"><a href="/#contact" class="nav__link">Contact</a></li>
         <li class="nav__item">
  <!-- Hidden Google Translate Widget -->
<script defer src="../static/main.js"></script>

<select id="language-select" class="lang-select">
  <option value="">Select Language</option>
  <option value="en">English</option>
  <option value="hi">Hindi (हिन्दी)</option>
  <option value="mr">Marathi (मराठी)</option>
  <option value="ta">Tamil (தமிழ்)</option>
  <option value="te">Telugu (తెలుగు)</option>
  <option value="bn">Bengali (বাংলা)</option>
  <option value="gu">Gujarati (ગુજરાતી)</option>
  <option value="kn">Kannada (ಕನ್ನಡ)</option>
  <option value="ml">Malayalam (മലയാളം)</option>
  <option value="pa">Punjabi (ਪੰਜਾਬੀ)</option>
  <option value="or">Odia (ଓଡ଼ିଆ)</option>
  <option value="ur">Urdu (اردو)</option>
  <option value="as">Assamese (অসমীয়া)</option>
  <option value="bh">Bhojpuri (भोजपुरी)</option>
  <option value="mni">Manipuri (মৈতৈলোন)</option>
  <option value="ne">Nepali (नेपाली)</option>
  <option value="sd">Sindhi (سنڌي)</option>
  <option value="kok">Konkani (कोंकणी)</option>
  <option value="ks">Kashmiri (كٲشُر)</option>
  <option value="sa">Sanskrit (संस्कृतम्)</option>
</select>

</li>


    </nav>
  </header>
  <!-- Main Content -->
  <main class="bd-container section" id="find-doctors">
    <h1 class="section-title">Find Nearby Doctors</h1>
    <p class="section-subtitle">Enter your area or city to find nearby doctors.</p>

    <form id="doctor-form" class="bd-grid" style="max-width:600px;margin:auto;">
      <input type="text" id="location" placeholder="e.g. Delhi, Bhopal" style="width:100%; padding:1rem; margin-top:0.5rem;" required />
      <button type="submit" style="margin-top:1rem; padding:0.8rem; background:#069C54; color:white; border:none; cursor:pointer;">
        Search Doctors
      </button>
    </form>

    <!-- Specialist filter UI -->
    <div class="filter-bar">
  <label for="specialty-select">Choose Specialist:</label>
  <select id="specialty-select">
    <option value="All">All</option>
    <option value="Cardiologist">Cardiologist</option>
    <option value="Neurologist">Neurologist</option>
    <option value="Dermatologist">Dermatologist</option>
    <option value="Pediatrician">Pediatrician</option>
    <option value="Dentist">Dentist</option>
    <option value="General">General</option>
    <!-- Add more as needed -->
  </select>
  <button id="filter-btn" type="button">Filter</button>
</div>

    <div id="doctor-list" style="margin-top:2rem; text-align:center;"></div>
    <div id="mapid"></div>
  </main>

  <!-- Footer -->
  <footer class="section">
    <div class="bd-container" style="text-align:center;">
      <p>&copy; 2025 Mediwise. All rights reserved.</p>
    </div>
  </footer>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    let mymap = null;
    let doctorMarkers = [];
    let allDoctors = [];

    function initializeMap(lat, lon) {
      if (mymap !== null) {
        mymap.remove();
      }
      mymap = L.map('mapid').setView([lat, lon], 13);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors'
      }).addTo(mymap);
    }

    function renderDoctors(doctors) {
      const doctorListDiv = document.getElementById("doctor-list");
      if (!doctors.length) {
        doctorListDiv.innerHTML = "No doctors found.";
        return;
      }
      doctorListDiv.innerHTML = '<ul>' + doctors.map(
        d => `<li><b>${d.name}</b> (${d.specialty || 'General'}) - ${d.address}</li>`
      ).join('') + '</ul>';
    }

   function renderDoctors(doctors) {
  const doctorListDiv = document.getElementById("doctor-list");
  if (!doctors.length) {
    doctorListDiv.innerHTML = "No doctors found.";
    return;
  }
  doctorListDiv.innerHTML = '<ul>' + doctors.map(
    d => `<li>
      <b>${d.name}</b> (${d.specialty || 'General'})<br>
      ${d.address}<br>
      <b>Contact:</b> ${d.phone || 'Not available'}
    </li>`
  ).join('') + '</ul>';
}

    function updateSpecialtyOptions(doctors) {
      const select = document.getElementById("specialty-select");
      const specialties = Array.from(new Set(doctors.map(d => d.specialty || 'General')));
      select.innerHTML = `<option value="All">All</option>` +
        specialties.map(s => `<option value="${s}">${s}</option>`).join('');
    }

    document.getElementById("doctor-form").addEventListener("submit", async function (event) {
      event.preventDefault();
      const location = document.getElementById("location").value.trim();
      const doctorListDiv = document.getElementById("doctor-list");
      const mapDiv = document.getElementById("mapid");
      if (!location) {
        doctorListDiv.innerHTML = '<p style="color:red;">Please enter a location to search.</p>';
        return;
      }
      doctorListDiv.innerHTML = 'Searching...';
      mapDiv.style.display = "none";
      try {
        const response = await fetch('/api/find_doctors', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ location: location }),
        });
        if (!response.ok) {
          let err = "No doctors found.";
          try {
            const data = await response.json();
            err = data.error || err;
          } catch {}
          doctorListDiv.innerHTML = err;
          return;
        }
        const data = await response.json();
        if (data.center) {
          mapDiv.style.display = "block";
          initializeMap(data.center.lat, data.center.lon);
          allDoctors = data.doctors || [];
          updateSpecialtyOptions(allDoctors);
          renderDoctors(allDoctors);
          renderMarkers(allDoctors);
        } else {
          doctorListDiv.innerHTML = data.error || "No doctors found.";
        }
      } catch (e) {
        doctorListDiv.innerHTML = "Network error.";
      }
    });

   document.getElementById("filter-btn").addEventListener("click", function () {
  const selected = document.getElementById("specialty-select").value;
  const filtered = selected === "All"
    ? allDoctors
    : allDoctors.filter(d => (d.specialty || 'General').toLowerCase().includes(selected.toLowerCase()));
  renderDoctors(filtered);
  renderMarkers(filtered);
});
function renderDoctors(doctors) {
  const doctorListDiv = document.getElementById("doctor-list");
  if (!doctors.length) {
    doctorListDiv.innerHTML = "No doctors found.";
    return;
  }
  doctorListDiv.innerHTML = '<ul>' + doctors.map(
    d => `<li>
      <b>${d.name}</b> (${d.specialty || 'General'})<br>
      ${d.address}<br>
      <b>Contact:</b> ${d.phone || 'Not available'}
    </li>`
  ).join('') + '</ul>';
}
  </script>
</body>
</html>